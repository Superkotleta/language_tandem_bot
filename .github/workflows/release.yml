name: Create Release

on:
  push:
    tags:
      - 'v*'  # v1.0.0, v1.2.3, etc.

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v5
      with:
        fetch-depth: 0  # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ changelog
    
    - name: Set up Go
      uses: actions/setup-go@v6
      with:
        go-version: 1.25.1
    
    - name: Build binaries
      run: |
        # –°–æ–±–∏—Ä–∞–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
        GOOS=linux GOARCH=amd64 go build -o bin/language-exchange-bot-linux-amd64 ./services/bot/cmd/bot
        GOOS=windows GOARCH=amd64 go build -o bin/language-exchange-bot-windows-amd64.exe ./services/bot/cmd/bot
        GOOS=darwin GOARCH=amd64 go build -o bin/language-exchange-bot-darwin-amd64 ./services/bot/cmd/bot
        GOOS=darwin GOARCH=arm64 go build -o bin/language-exchange-bot-darwin-arm64 ./services/bot/cmd/bot
    
    - name: Generate changelog
      id: changelog
      run: |
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º changelog –∏–∑ git log
        git log --pretty=format:"- %s (%h)" $(git describe --tags --abbrev=0 HEAD^)..HEAD > CHANGELOG.md
        echo "changelog<<EOF" >> $GITHUB_OUTPUT
        cat CHANGELOG.md >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
    
    - name: Create Release
      uses: softprops/action-gh-release@v2.4.0
      with:
        tag_name: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
        body: |
          ## üöÄ Language Exchange Bot ${{ github.ref_name }}
          
          ### üìã Changes
          ${{ steps.changelog.outputs.changelog }}
          
          ### üì¶ Downloads
          - **Linux AMD64**: `language-exchange-bot-linux-amd64`
          - **Windows AMD64**: `language-exchange-bot-windows-amd64.exe`
          - **macOS AMD64**: `language-exchange-bot-darwin-amd64`
          - **macOS ARM64**: `language-exchange-bot-darwin-arm64`
          
          ### üê≥ Docker
          ```bash
          docker pull your-username/language-exchange-bot:${{ github.ref_name }}
          ```
          
          ### üìö Documentation
          - [API Documentation](https://github.com/${{ github.repository }}/blob/main/api/README.md)
          - [Architecture Guide](https://github.com/${{ github.repository }}/blob/main/ARCHITECTURE.md)
        files: |
          bin/language-exchange-bot-linux-amd64
          bin/language-exchange-bot-windows-amd64.exe
          bin/language-exchange-bot-darwin-amd64
          bin/language-exchange-bot-darwin-arm64
        draft: false
        prerelease: false
