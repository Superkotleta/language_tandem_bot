name: Test Secrets Configuration

on:
  workflow_dispatch:  # –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: üîê Test Docker Secrets
      run: |
        echo "üê≥ Docker Configuration:"
        if [ -n "${{ secrets.DOCKER_USERNAME }}" ]; then
          echo "‚úÖ DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}"
        else
          echo "‚ùå DOCKER_USERNAME: Not set"
        fi
        
        if [ -n "${{ secrets.DOCKER_TOKEN }}" ]; then
          echo "‚úÖ DOCKER_TOKEN: ${#secrets.DOCKER_TOKEN} characters"
        else
          echo "‚ùå DOCKER_TOKEN: Not set"
        fi
    
    - name: üñ•Ô∏è Test Server Secrets
      run: |
        echo "üñ•Ô∏è Server Configuration:"
        if [ -n "${{ secrets.SERVER_HOST }}" ]; then
          echo "‚úÖ SERVER_HOST: ${{ secrets.SERVER_HOST }}"
        else
          echo "‚ùå SERVER_HOST: Not set"
        fi
        
        if [ -n "${{ secrets.SERVER_USER }}" ]; then
          echo "‚úÖ SERVER_USER: ${{ secrets.SERVER_USER }}"
        else
          echo "‚ùå SERVER_USER: Not set"
        fi
        
        if [ -n "${{ secrets.SERVER_SSH_KEY }}" ]; then
          echo "‚úÖ SERVER_SSH_KEY: ${#secrets.SERVER_SSH_KEY} characters"
        else
          echo "‚ùå SERVER_SSH_KEY: Not set"
        fi
        
        if [ -n "${{ secrets.SERVER_URL }}" ]; then
          echo "‚úÖ SERVER_URL: ${{ secrets.SERVER_URL }}"
        else
          echo "‚ùå SERVER_URL: Not set"
        fi
    
    - name: üì± Test Telegram Secrets
      run: |
        echo "üì± Telegram Configuration:"
        if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
          echo "‚úÖ TELEGRAM_BOT_TOKEN: ${#secrets.TELEGRAM_BOT_TOKEN} characters"
        else
          echo "‚ùå TELEGRAM_BOT_TOKEN: Not set"
        fi
        
        if [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
          echo "‚úÖ TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}"
        else
          echo "‚ùå TELEGRAM_CHAT_ID: Not set"
        fi
    
    - name: üí¨ Test Slack Secrets
      run: |
        echo "üí¨ Slack Configuration:"
        if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
          echo "‚úÖ SLACK_WEBHOOK_URL: ${#secrets.SLACK_WEBHOOK_URL} characters"
        else
          echo "‚ö†Ô∏è SLACK_WEBHOOK_URL: Not set (optional)"
        fi
    
    - name: üß™ Test Telegram Bot
      if: secrets.TELEGRAM_BOT_TOKEN != '' && secrets.TELEGRAM_CHAT_ID != ''
      run: |
        echo "üì± Testing Telegram bot..."
        curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -H "Content-Type: application/json" \
          -d "{
            \"chat_id\": \"${{ secrets.TELEGRAM_CHAT_ID }}\",
            \"text\": \"üß™ GitHub Actions Secrets Test\\n\\n‚úÖ All secrets configured successfully!\\nüöÄ Language Exchange Bot CI/CD is ready!\"
          }"
    
    - name: üìä Summary
      run: |
        echo "üìã Secrets Configuration Summary:"
        echo "================================"
        
        # Count configured secrets
        COUNT=0
        TOTAL=8
        
        [ -n "${{ secrets.DOCKER_USERNAME }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.DOCKER_TOKEN }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.SERVER_HOST }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.SERVER_USER }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.SERVER_SSH_KEY }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.SERVER_URL }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ] && COUNT=$((COUNT+1))
        [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ] && COUNT=$((COUNT+1))
        
        echo "Configured: $COUNT/$TOTAL secrets"
        
        if [ $COUNT -eq $TOTAL ]; then
          echo "üéâ All required secrets are configured!"
          echo "üöÄ Your CI/CD pipeline is ready for production!"
        else
          echo "‚ö†Ô∏è Some secrets are missing. Please check the configuration."
          echo "üìñ See SETUP_SECRETS_GUIDE.md for detailed instructions."
        fi
