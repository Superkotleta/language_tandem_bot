# Language Tandem Bot

🌍 **Enterprise-уровень Telegram бот для поиска партнёров по изучению языков**

> **v3.0.0** - Enterprise-grade система с микросервисной архитектурой, многоуровневым кешированием, мониторингом и автоматизированными тестами.

Бот предназначен для поиска собеседников в целях взаимного изучения языков с использованием современных технологий и лучших практик разработки.

## 🚀 Быстрый старт

🗺️ **[Открыть навигационную панель](http://localhost:8080/)** - все сервисы и документация в одном месте

### 📊 Текущее состояние проекта

| Компонент | Статус | Покрытие | Тестов |
|-----------|--------|----------|---------|
| **Server/API Layer** | ✅ Готов | **41.5%** | 20+ |
| **Models Package** | ✅ Готов | **100%** | 20+ |
| **Config Package** | ✅ Готов | **90.1%** | 50+ |
| **Database Layer** | ✅ Готов | **28.6%** | 25+ |
| **Validation Service** | ✅ Готов | **92.5%** | 45+ |
| **Telegram Handlers** | 🔄 В работе | **13.7%** | 15+ |
| **Core Business Logic** | 🔄 В работе | **7.0%** | 3+ |
| **Integration Tests** | ✅ Готов | **31.9%** | 5+ |

### Основные команды

```bash
# 🚀 Запуск в production
docker-compose up -d

# 🧪 Запуск с тестами (development)
cd services/bot && go test ./... -v && go run cmd/bot/main.go

# 📊 Проверка покрытия тестами
cd services/bot && go test ./... -coverprofile=coverage.out && go tool cover -html=coverage.out

# 🌐 Development запуск (polling mode - default)
cd services/bot && go run cmd/bot/main.go

# 🪝 Development запуск (webhook mode)
cd services/bot && TELEGRAM_MODE=webhook WEBHOOK_URL=https://your-domain.com go run cmd/bot/main.go

# 💚 Проверка здоровья системы
curl http://localhost:8080/healthz

# 📖 API документация (Swagger)
open http://localhost:8080/swagger/

# 🔧 Статус webhook
curl -H "X-Admin-Key: admin-secret-key" http://localhost:8080/api/v1/webhook/status

# 📈 Системные метрики (v2 API)
curl -H "X-Admin-Key: admin-secret-key" http://localhost:8080/api/v2/metrics/performance
```

## 🔄 Режимы работы Telegram бота

### 📡 **Polling Mode** (по умолчанию)

```bash
# Переменные окружения
TELEGRAM_MODE=polling  # или не указывать
```

**Как работает:**

- Бот активно запрашивает обновления от Telegram API каждые 60 секунд
- Подходит для development и небольших нагрузок
- Не требует HTTPS и публичного IP

### 🪝 **Webhook Mode** (production)

```bash
# Переменные окружения
TELEGRAM_MODE=webhook
WEBHOOK_URL=https://your-domain.com  # Должен быть HTTPS!
```

**Как работает:**

- Telegram отправляет обновления на ваш endpoint в реальном времени
- Эффективнее для высоких нагрузок
- Требует HTTPS и публичного доступа
- URL: `https://your-domain.com/webhook/telegram/{token}`

### 🔀 **Переключение между режимами**

```bash
# Измените переменную окружения и перезапустите
export TELEGRAM_MODE=webhook
export WEBHOOK_URL=https://your-production-domain.com

# Или для development
export TELEGRAM_MODE=polling
```

### 📋 **API для управления webhook**

```bash
# Проверить статус webhook
GET /api/v1/webhook/status

# Настроить webhook (через API)
POST /api/v1/webhook/setup
{
  "webhook_url": "https://your-domain.com"
}

# Удалить webhook
POST /api/v1/webhook/remove
```

## 🎯 Ключевые возможности (v3.0.0)

### 🚀 Enterprise-уровень архитектуры

#### 🏗️ **Микросервисная архитектура**

- **Clean Architecture** с четким разделением на слои (Adapters, Core, Database, Server)
- **API Versioning** (v1/v2) с обратной совместимостью
- **Circuit Breaker** защита от каскадных сбоев
- **Graceful shutdown** с контекстами и таймаутами

#### 🧪 **Автоматизированное тестирование**

- **200+ unit тестов** с покрытием 20.6%+ по проекту
- **Enterprise-grade coverage**: Models (100%), Config (90.1%), Validation (92.5%)
- **Integration тесты** для критических пользовательских сценариев
- **E2E тесты** для полного цикла регистрации и работы с ботом
- **CI/CD pipeline** с автоматическими тестами и линтером

#### 📊 **Многоуровневое кеширование**

- **Redis + In-memory** кеш с автоматическим fallback
- **Batch loading** - 75% снижение количества запросов к БД
- **TTL управление** с умной инвалидацией
- **Производительность**: 60-80% ускорение ответов

#### 🚨 **Централизованная обработка ошибок**

- **15+ типов кастомных ошибок** с типизацией
- **RequestID трейсинг** для отслеживания запросов
- **Автоматические алерты** администраторам
- **JSON логирование** с уровнями и контекстом

#### 📈 **Мониторинг и метрики**

- **Веб-дашборд** в реальном времени
- **Health checks** для всех компонентов
- **Производительность метрики** (время выполнения, кеш-хиты)
- **Системные показатели** (CPU, память, соединения)

### 🤖 Функциональность бота

#### 👤 **Управление профилем**

- **Расширенный профиль** с детальной информацией о пользователе
- **Категоризированные интересы** (развлечения, образование, активный отдых, творчество, социальные)
- **Приоритизация интересов** (основные до 3-х, дополнительные)
- **Изолированное редактирование** с безопасным сохранением изменений
- **Многоязычная поддержка** (русский, английский, испанский, китайский)

#### 🎯 **Умная система matching**

- **Алгоритм совместимости** на основе языков и интересов
- **Фильтры поиска** по уровню владения языком и предпочтениям
- **Геолокация** (опционально) для поиска локальных партнеров
- **Статистика совместимости** с подробными метриками

#### 🌐 **Локализация и UX**

- **4 языка интерфейса** с полной локализацией
- **Интуитивные меню** с emoji и понятной навигацией
- **Контекстная помощь** в каждом разделе
- **Адаптивный интерфейс** под разные устройства

## 🏗️ Архитектура системы

### 🏛️ **Clean Architecture**

```shell
┌─────────────────────────────────────────────────┐
│                 Delivery Layer                   │
│  ┌─────────────────────────────────────────────┐ │
│  │           Adapters Layer                     │ │
│  │  ┌─────────────────────────────────────────┐ │ │
│  │  │        Core Business Logic               │ │ │
│  │  │  ┌─────────────────────────────────────┐ │ │ │
│  │  │  │      Database/External APIs          │ │ │ │
│  │  │  └─────────────────────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

#### 📦 **Слои архитектуры:**

1. **🎯 Core Layer** - Бизнес-логика (Models, Services, Use Cases)
2. **🔌 Adapters Layer** - Внешние интерфейсы (Telegram, HTTP API, Database)
3. **🚀 Delivery Layer** - Точка входа (main.go, HTTP handlers)

### 📊 **Микросервисы**

| Сервис | Статус | Порт | Функциональность |
|--------|--------|------|------------------|
| **🤖 Bot Service** | ✅ Активен | 8080 | Telegram бот + Admin API |
| **🎯 Matcher Service** | ⏸️ Отключен | - | Алгоритм подбора партнеров |
| **👤 Profile Service** | ⏸️ Отключен | - | CRUD профилей пользователей |

### 🗄️ **База данных**

- **PostgreSQL** (production) + **SQLite** (testing)
- **13+ миграций** инициализации
- **Connection pooling** и health checks
- **Query optimization** с индексами

## 📁 Структура проекта

```shell
services/
├── bot/                     # 🤖 Основной микросервис (АКТИВЕН)
│   ├── cmd/bot/            # 🚀 Точка входа приложения
│   ├── internal/
│   │   ├── adapters/       # 🔌 Внешние интерфейсы (Telegram, HTTP)
│   │   ├── core/           # 🎯 Бизнес-логика и сервисы
│   │   ├── database/       # 🗄️ Работа с PostgreSQL/SQLite
│   │   ├── models/         # 📋 Структуры данных
│   │   ├── config/         # ⚙️ Конфигурация (env, JSON)
│   │   ├── validation/     # ✅ Валидация данных
│   │   ├── cache/          # 📊 Кеширование (Redis/in-memory)
│   │   ├── errors/         # 🚨 Централизованная обработка ошибок
│   │   ├── logging/        # 📝 Структурированное логирование
│   │   ├── server/         # 🌐 HTTP API сервер
│   │   └── localization/   # 🌐 Многоязычная поддержка
│   ├── locales/            # 📖 Переводы (ru, en, es, zh)
│   ├── tests/              # 🧪 Интеграционные тесты
│   └── Dockerfile          # 🐳 Контейнеризация
├── matcher/                # 🎯 Сервис подбора партнеров (ОТКЛЮЧЕН)
│   ├── cmd/matcher/        # 🚀 HTTP API
│   ├── internal/           # ⚙️ Конфигурация и обработчики
│   └── migrations/         # 🗄️ Схема БД для matching
├── profile/                # 👤 Сервис профилей (ОТКЛЮЧЕН)
│   ├── cmd/profile/        # 🚀 HTTP API
│   ├── internal/           # ⚙️ Конфигурация и обработчики
│   └── migrations/         # 🗄️ Схема БД для профилей
└── deploy/                 # 🚀 Инфраструктура развертывания
    ├── docker-compose.yml  # 🐳 Конфигурация сервисов
    ├── db-init/           # 🗄️ SQL скрипты инициализации (13 файлов)
    ├── migrations/        # 🔄 Миграции после инициализации
    ├── linter/            # 🧹 Конфигурация линтера
    └── ENV_SETUP.md       # 📋 Настройка окружения
```

### 🔧 Ключевые компоненты

| Компонент | Технология | Назначение |
|-----------|------------|------------|
| **🤖 Bot Service** | Go + Telegram API | Основной микросервис бота |
| **🗄️ PostgreSQL** | Реляционная БД | Хранение данных пользователей |
| **📊 Redis** | In-memory cache | Кеширование для производительности |
| **🐳 Docker** | Контейнеризация | Изоляция и развертывание |
| **📈 Prometheus** | Мониторинг | Метрики и алерты |
| **📝 Swagger** | API Docs | Документация Admin API |

### 🧪 **Тестирование**

| Тип тестов | Покрытие | Количество | Статус |
|------------|----------|------------|---------|
| **Unit Tests** | 20.6% | 200+ | ✅ Активно |
| **Integration** | 31.9% | 5+ | ✅ Активно |
| **E2E Tests** | - | - | 🔄 Планируется |
| **Performance** | - | - | 🔄 Планируется |

## 💬 Руководство пользователя

### 🚀 **Быстрый старт с ботом**

1. **Найдите бота**: [@language_tandem_bot](https://t.me/language_tandem_bot)
2. **Отправьте** `/start` - бот автоматически определит ваш язык
3. **Заполните профиль** - укажите родной и изучаемый языки
4. **Выберите интересы** - категоризированный выбор с приоритизацией
5. **Начните общаться** - бот найдет подходящих партнеров

### 🎯 **Основные команды**

| Команда | Описание | Доступ |
|---------|----------|---------|
| `/start` | Запуск бота и главное меню | Все пользователи |
| `/profile` | Просмотр и редактирование профиля | Зарегистрированные |
| `/language` | Смена языка интерфейса | Все пользователи |
| `/status` | Детальный статус профиля | Зарегистрированные |
| `/reset` | Сброс профиля | Зарегистрированные |
| `/admin` | Админ-панель (статистика отзывов) | Администраторы |

### 🌐 **Многоязычная поддержка**

Бот поддерживает **4 языка** с полной локализацией:

- 🇷🇺 **Русский** - основной язык разработки
- 🇺🇸 **English** - международная версия
- 🇪🇸 **Español** - испанская версия
- 🇨🇳 **中文** - китайская версия

**Автоматическое определение языка** по настройкам Telegram клиента.

## 🔧 API документация

### 🌐 **Navigation Dashboard - Интерактивная панель**

**Расширенная функциональность планируется:**

- **API Explorer** - интерактивное тестирование endpoints прямо из браузера
- **Real-time Metrics** - графики производительности с auto-refresh
- **Quick Actions** - быстрые административные операции (очистка кеша, перезапуск сервисов)
- **System Commands** - выполнение команд управления через веб-интерфейс
- **Log Viewer** - просмотр логов в реальном времени
- **Alert Management** - управление и разрешение алертов

### 📋 **Admin API (v1/v2)**

Бот предоставляет REST API для административных функций:

#### 🚀 **Ключевые эндпоинты**

```bash
# Health checks
GET  /healthz     # Readiness probe
GET  /readyz      # Liveness probe

# API v1 (стабильная версия)
GET  /api/v1/stats                    # Статистика системы
GET  /api/v1/users/{id}              # Информация о пользователе
GET  /api/v1/users                   # Список пользователей
GET  /api/v1/feedback/unprocessed    # Необработанные отзывы
POST /api/v1/feedback/{id}/process   # Обработка отзыва

# API v2 (расширенная версия)
GET  /api/v2/stats                    # Расширенная статистика
GET  /api/v2/system/health           # Детальное здоровье системы
GET  /api/v2/metrics/performance     # Метрики производительности
```

#### 🔐 **Аутентификация**

```bash
# Заголовок для всех API запросов
X-Admin-Key: your-admin-secret-key
```

### 📖 **Swagger документация**

- **URL**: `http://localhost:8080/swagger/`
- **Формат**: OpenAPI 3.0
- **Интерактивный интерфейс** для тестирования API

## 📚 Документация проекта

### 📖 **Основные документы**

| Документ | Описание | Статус |
|----------|----------|---------|
| **[README.md](README.md)** | Общая документация и quick start | ✅ Актуально |
| **[ARCHITECTURE.md](ARCHITECTURE.md)** | Архитектура системы с диаграммами | ✅ Актуально |
| **[CHANGELOG.md](CHANGELOG.md)** | История изменений и версий | ✅ Актуально |
| **[INTERESTS_SYSTEM.md](INTERESTS_SYSTEM.md)** | Документация системы интересов | ✅ Актуально |
| **[SERVICES.md](SERVICES.md)** | Описание микросервисов | ✅ Актуально |
| **[NAVIGATION_DASHBOARD_2.0.md](NAVIGATION_DASHBOARD_2.0.md)** | План развития Dashboard 2.0 | ✅ Детальный план |

### 🏗️ **Архитектурная документация**

#### **Clean Architecture диаграммы**

```shell
┌─────────────────────────────────────────────────┐
│                 Delivery Layer                   │
│  ┌─────────────────────────────────────────────┐ │
│  │           Adapters Layer                     │ │
│  │  ┌─────────────────────────────────────────┐ │ │
│  │  │        Core Business Logic               │ │ │
│  │  │  ┌─────────────────────────────────────┐ │ │ │
│  │  │  │      Database/External APIs          │ │ │ │
│  │  │  └─────────────────────────────────────┘ │ │ │
│  │  └─────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

#### **Микросервисная архитектура**

- **Bot Service** (Go) - Основной микросервис
- **Matcher Service** (Go) - Алгоритмы подбора партнеров
- **Profile Service** (Go) - Управление профилями

### 🧪 **Тестирование компонентов**

#### **Покрытие по компонентам**

- **Models**: 100% (структуры данных, JSON сериализация)
- **Config**: 90.1% (загрузка конфигурации, валидация)
- **Validation**: 92.5% (правила валидации, обработка ошибок)
- **Database**: 28.6% (CRUD операции, SQL запросы)
- **Server**: 41.5% (HTTP handlers, middleware)
- **Cache**: 26.8% (Redis/in-memory операции)

#### **Типы тестов**

- ✅ **Unit tests**: 200+ тестов, изоляция компонентов
- ✅ **Integration tests**: E2E сценарии, взаимодействие компонентов
- 🔄 **Performance tests**: планируется
- 🔄 **Load tests**: планируется

### 🚀 **Развертывание**

#### **Production среда**

```bash
# Docker Compose
docker-compose up -d

# Проверка здоровья
curl http://localhost:8080/healthz
curl http://localhost:8080/readyz
```

#### **Development среда**

```bash
# Запуск с тестами
cd services/bot && go test ./... && go run cmd/bot/main.go

# Покрытие тестами
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out
```

## 🤝 Контрибьютинг

### 🐛 Сообщение об ошибках

Используйте GitHub Issues для сообщения о багах и проблемах.

### 💡 Предложения по улучшению

Для новых фич и улучшений создавайте GitHub Issues с меткой `enhancement`.

### 🔧 Разработка

```bash
# Клонирование репозитория
git clone https://github.com/your-org/language-tandem-bot.git
cd language-tandem-bot

# Запуск в режиме разработки
cd services/bot
go run cmd/bot/main.go

# Запуск тестов
go test ./...
```

### 📝 Code Style

- Следуйте стандартным Go conventions
- Используйте `gofmt` для форматирования
- Добавляйте тесты для новых функций
- Обновляйте документацию

## 🔮 **Планы развития**

### 📋 **Roadmap**

1. **Phase 1** ✅ *Завершена*: Enterprise-grade монолит с тестированием
2. **Phase 2** 🔄 *В работе*: Расширение Navigation Dashboard
3. **Phase 3** 📋 *Планируется*: Восстановление микросервисов
4. **Phase 4** 📋 *Планируется*: Kubernetes оркестрация
5. **Phase 5** 📋 *Планируется*: Multi-region развертывание

### 🎯 **Будущие улучшения**

#### 🌐 **Navigation Dashboard 2.0** (Phase 2)

**Цель**: Преобразовать статическую навигационную панель в полнофункциональный центр управления системой

##### **Interactive API Explorer**

- **API Testing**: Выполнение REST запросов прямо из браузера
- **Request Builder**: Визуальный конструктор запросов с параметрами
- **Response Viewer**: Форматированный просмотр ответов JSON/XML
- **Request History**: Сохранение и повтор предыдущих запросов
- **Authentication**: Автоматическая подстановка API ключей

##### **Real-time Monitoring Dashboard**

- **Live Metrics**: Графики производительности с auto-refresh (5 сек)
- **System Health**: Реальное время статус всех компонентов
- **Performance Charts**: CPU, память, network, database connections
- **Alert Center**: Активные алерты с возможностью разрешения
- **Historical Data**: Просмотр метрик за последние 24 часа

##### **System Management Interface**

- **Quick Actions**: Очистка кеша, перезапуск сервисов, reload конфигурации
- **Command Execution**: Выполнение административных команд через веб
- **Configuration Editor**: Редактирование настроек через UI
- **Backup/Restore**: Управление резервным копированием
- **Service Control**: Start/stop/restart отдельных компонентов

##### **Live Log Viewer**

- **Real-time Logs**: Просмотр логов всех сервисов в реальном времени
- **Filtering**: По уровню логирования, компоненту, времени
- **Search**: Полнотекстовый поиск в логах
- **Export**: Скачивание логов для анализа
- **Log Levels**: DEBUG, INFO, WARN, ERROR с цветовой индикацией

##### **Техническая реализация**

- **Frontend**: HTML/CSS/JavaScript с AJAX для API вызовов
- **Backend**: Расширение HTTP сервера новыми endpoints
- **WebSocket**: Для real-time обновлений метрик и логов
- **Security**: Защита административных функций API ключами
- **Responsive**: Адаптивный дизайн для мобильных устройств

##### **Этапы реализации**

1. **API Explorer** (2 недели) - базовый интерфейс тестирования API
2. **Real-time Metrics** (1 неделя) - live графики производительности
3. **System Management** (2 недели) - быстрые административные действия
4. **Log Viewer** (1 неделя) - просмотр логов в реальном времени
5. **Alert Management** (1 неделя) - управление системными алертами
6. **UI/UX Polish** (1 неделя) - финализация интерфейса и usability

#### 🔧 **Микросервисы** (Phase 3)

- **Matcher Service**: Алгоритмы подбора партнеров
- **Profile Service**: Управление профилями пользователей
- **API Gateway**: Единая точка входа с load balancing

#### 🚀 **DevOps & Scaling** (Phase 4)

- **CI/CD Pipeline**: Полная автоматизация развертывания
- **Kubernetes**: Оркестрация контейнеров
- **Service Mesh**: Istio для управления трафиком
- **Monitoring Stack**: Prometheus + Grafana + ELK

#### 🌍 **Распределенная архитектура** (Phase 5)

- **Multi-region deployment**: Глобальное распределение
- **CDN integration**: Оптимизация доставки контента
- **Advanced caching**: Распределенное кеширование

---
