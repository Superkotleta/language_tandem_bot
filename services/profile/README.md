# Сервис Профилей

Сервис Профилей отвечает за управление профилями пользователей, языками, интересами, предпочтениями, характеристиками и доступностью по времени в микросервисной архитектуре Language Exchange Bot.

## Возможности

- **Управление пользователями**: Создание, чтение, обновление и удаление профилей пользователей
- **Управление языками**: Управление языками и уровнем владения языками пользователей
- **Управление интересами**: Управление интересами и интересами пользователей
- **Управление предпочтениями**: Управление предпочтениями пользователей для поиска партнеров
- **Управление характеристиками**: Управление личностными и учебными характеристиками пользователей
- **Доступность по времени**: Управление доступностью пользователей для языкового обмена
- **Завершенность профиля**: Расчет показателей завершенности профиля
- **Поиск и фильтрация**: Поиск пользователей с различными фильтрами

## API Эндпоинты

### Пользователи

- `POST /api/v1/users` - Создать нового пользователя
- `GET /api/v1/users` - Список пользователей с пагинацией и фильтрацией
- `GET /api/v1/users/{id}` - Получить пользователя по ID
- `PUT /api/v1/users/{id}` - Обновить пользователя
- `DELETE /api/v1/users/{id}` - Удалить пользователя
- `GET /api/v1/users/telegram/{telegram_id}` - Получить пользователя по Telegram ID
- `GET /api/v1/users/discord/{discord_id}` - Получить пользователя по Discord ID
- `PUT /api/v1/users/{id}/last-seen` - Обновить время последнего посещения
- `GET /api/v1/users/{id}/completion` - Получить показатель завершенности профиля

### Проверки состояния

- `GET /healthz` - Проверка состояния
- `GET /readyz` - Проверка готовности

## Схема базы данных

Сервис использует PostgreSQL со следующими основными таблицами:

- `users` - Профили пользователей
- `languages` - Доступные языки
- `user_languages` - Уровень владения языками пользователей
- `interests` - Доступные интересы
- `user_interests` - Интересы пользователей
- `user_preferences` - Предпочтения пользователей для поиска партнеров
- `user_traits` - Личностные характеристики пользователей
- `user_time_availability` - Доступность пользователей по времени

## Конфигурация

Сервис может быть настроен с помощью переменных окружения:

- `DATABASE_URL` - Строка подключения к PostgreSQL (по умолчанию: postgres://profile_rw:profile_pwd@postgres:5432/languagebot?sslmode=disable)
- `DB_SCHEMA` - Схема базы данных (по умолчанию: profile)
- `MIGRATIONS_DIR` - Директория миграций (по умолчанию: /migrations/profile)
- `HTTP_PORT` - Порт HTTP сервера (по умолчанию: 8081)
- `DEBUG` - Режим отладки (по умолчанию: false)

## Разработка

### Предварительные требования

- Go 1.22+
- PostgreSQL 13+
- Docker (опционально)

### Настройка

1. Клонируйте репозиторий
2. Установите зависимости:

   ```bash
   make deps
   ```

3. Настройте базу данных:

   ```bash
   make migrate-up
   ```

4. Запустите сервис:

   ```bash
   make run
   ```

### Тестирование

Запустите тесты:

```bash
make test
```

### Сборка

Соберите сервис:

```bash
make build
```

### Docker

Соберите и запустите с Docker:

```bash
make docker-build
make docker-run
```

## Документация API

Сервис включает документацию Swagger. Для её генерации:

```bash
make docs
```

## Архитектура

Сервис следует паттерну чистой архитектуры:

- **Handlers**: Обработка HTTP запросов/ответов
- **Services**: Бизнес-логика
- **Repositories**: Слой доступа к данным
- **Models**: Структуры данных и валидация

## Зависимости

- **Gin**: HTTP веб-фреймворк
- **pgx**: Драйвер PostgreSQL
- **Validator**: Валидация запросов
- **Zap**: Структурированное логирование
- **Swagger**: Документация API

## Мониторинг

Сервис включает:

- Эндпоинты проверки состояния
- Структурированное логирование
- Метрики Prometheus (запланировано)
- Распределенная трассировка (запланировано)

## Безопасность

- Валидация входных данных
- Предотвращение SQL-инъекций
- Ограничение скорости запросов (запланировано)
- Аутентификация/авторизация (запланировано)

## Производительность

- Пул соединений с базой данных
- Эффективные запросы с правильной индексацией
- Кэширование (запланировано)
- Балансировка нагрузки (запланировано)
