@echo off
REM Language Exchange Bot - Development Setup Script for Windows
REM –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å ngrok

echo üöÄ Language Exchange Bot - Development Setup
echo =============================================

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º Docker
where docker >nul 2>nul
if %errorlevel% neq 0 (
    echo ‚ùå Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    echo –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop: https://docs.docker.com/desktop/windows/install/
    pause
    exit /b 1
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º Docker Compose
where docker-compose >nul 2>nul
if %errorlevel% neq 0 (
    echo ‚ùå Docker Compose –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    echo –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose: https://docs.docker.com/compose/install/
    pause
    exit /b 1
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º curl
where curl >nul 2>nul
if %errorlevel% neq 0 (
    echo ‚ùå curl –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    echo –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ curl –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PowerShell
    pause
    exit /b 1
)

echo ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

REM –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª
if not exist .env (
    echo üìù –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞...
    copy env.optimized.example .env >nul
    echo ‚úÖ .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
) else (
    echo ‚úÖ .env —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º TELEGRAM_TOKEN
findstr /C:"TELEGRAM_TOKEN=your_telegram_bot_token_here" .env >nul
if %errorlevel% equ 0 (
    echo ‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ TELEGRAM_TOKEN
    echo.
    echo üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:
    echo 1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ @BotFather
    echo 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /newbot
    echo 3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
    echo 4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
    echo.
    set /p token="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞: "
    if not "%token%"=="" (
        powershell -Command "(Get-Content .env) -replace 'TELEGRAM_TOKEN=your_telegram_bot_token_here', 'TELEGRAM_TOKEN=%token%' | Set-Content .env"
        echo ‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω
    ) else (
        echo ‚ùå –¢–æ–∫–µ–Ω –Ω–µ –≤–≤–µ–¥–µ–Ω
        pause
        exit /b 1
    )
) else (
    echo ‚úÖ TELEGRAM_TOKEN —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
)

REM –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º ngrok
echo üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ngrok...
call scripts\setup-ngrok.bat

REM –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã
echo üê≥ –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–∏—Å–æ–≤...
make -f Makefile.optimized up

REM –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
echo ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤...
timeout /t 10 /nobreak >nul

REM –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º webhook
echo üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook...
call scripts\setup-webhook.bat

echo.
echo üéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
echo.
echo üìä –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
echo    ngrok UI: http://localhost:4040
echo    Bot Health: http://localhost:8080/health
echo    Bot Metrics: http://localhost:8080/metrics
echo    Grafana: http://localhost:3000 (admin/admin)
echo    Prometheus: http://localhost:9090
echo    PgAdmin: http://localhost:5050 (admin@admin.com/admin)
echo.
echo üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
echo    1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É –≤ Telegram
echo    2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: make -f Makefile.optimized logs
echo    3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: make -f Makefile.optimized monitor
echo.
echo üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
echo    make -f Makefile.optimized down
echo    scripts\stop-ngrok.bat

pause
