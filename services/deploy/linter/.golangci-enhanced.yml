# Улучшенная конфигурация golangci-lint
# Основана на практиках крупных компаний (Google, Uber, Netflix, etc.)

version: 2

run:
  timeout: 10m
  tests: true
  modules-download-mode: readonly
  go: "1.25"

linters:
  enable:
    # === БАЗОВЫЕ ЛИНТЕРЫ ===
    - unused          # неиспользуемый код
    - govet          # go vet проверки
    - ineffassign    # неэффективные присваивания
    - staticcheck    # статический анализ
    
    # === БЕЗОПАСНОСТЬ ===
    - gosec          # проверки безопасности
    - errcheck       # проверка ошибок
    - bodyclose      # закрытие HTTP соединений
    - noctx          # контекст в HTTP запросах
    - sqlclosecheck  # закрытие SQL соединений
    - errchkjson     # проверка JSON ошибок
    - errname        # именование ошибок
    - errorlint      # проверка обертывания ошибок
    - wrapcheck      # проверка обертывания ошибок
    
    # === ПРОИЗВОДИТЕЛЬНОСТЬ ===
    - prealloc       # предварительное выделение памяти
    - perfsprint     # оптимизация форматирования
    - fatcontext     # проверка контекстов
    - makezero       # инициализация слайсов
    - copyloopvar    # копирование переменных цикла
    - intrange       # оптимизация циклов
    
    # === СТИЛЬ КОДА ===
    - gocritic       # критические замечания
    - revive         # современный golint
    - goconst        # константы вместо магических строк
    - gocyclo        # цикломатическая сложность
    - funlen         # длина функций
    - gocognit       # когнитивная сложность
    - nestif         # вложенные if
    - cyclop         # цикломатическая сложность (альтернатива)
    - maintidx        # индекс поддерживаемости
    
    # === ТЕСТИРОВАНИЕ ===
    - testifylint    # проверки testify
    - paralleltest   # параллельные тесты
    - testpackage    # изоляция тестов
    - thelper        # тестовые хелперы
    - tparallel      # проверка t.Parallel()
    
    # === КАЧЕСТВО КОДА ===
    - gochecknoinits # отсутствие init функций
    - gochecknoglobals # отсутствие глобальных переменных
    - mnd            # магические числа
    - gomoddirectives # директивы go.mod
    - unparam        # неиспользуемые параметры
    - unconvert      # ненужные преобразования типов
    - nakedret       # голые возвраты
    - nlreturn       # новые строки перед return
    
    # === СОВРЕМЕННЫЕ ЛИНТЕРЫ ДЛЯ GO 1.25 ===
    - sloglint       # проверки log/slog
    - usestdlibvars  # использование стандартных переменных
    - exptostd       # замена exp функциями std
    # - containedctx   # проверка context в структурах (слишком строгий)
    - durationcheck  # проверка умножения duration
    # - forcetypeassert # принудительные приведения типов (слишком строгий)
    # - funcorder      # порядок функций (слишком строгий)
    - gochecksumtype # проверка sum типов
    - godoclint      # проверка документации
    - godot          # точки в комментариях
    - goheader       # заголовки файлов
    - goprintffuncname # именование printf функций
    - grouper        # группировка выражений
    - iface          # проверка интерфейсов
    - inamedparam    # именованные параметры
    # - interfacebloat # раздувание интерфейсов (слишком строгий)
    - iotamixing     # смешивание iota
    - ireturn        # возврат интерфейсов
    - lll            # длинные строки
    - loggercheck    # проверка логгеров
    - mirror         # зеркальные паттерны
    # - musttag        # обязательные теги (слишком строгий)
    - nilerr         # nil ошибки
    - nilnesserr     # проверка nil ошибок
    - nilnil         # одновременный nil
    # - noinlineerr    # встроенная обработка ошибок (слишком строгий)
    - nolintlint     # проверка nolint
    - nonamedreturns # именованные возвраты
    - nosprintfhostport # sprintf для host:port
    - predeclared    # переопределение предопределенных
    - protogetter    # getter для proto
    - reassign       # переприсваивание переменных
    - recvcheck      # проверка получателей
    # - rowserrcheck   # проверка Rows.Err (слишком строгий)
    - spancheck      # проверка spans
    - testableexamples # тестируемые примеры
    - unqueryvet     # проверка SQL запросов
    - usetesting     # использование testing
    # - varnamelen     # длина имен переменных (слишком строгий)
    - wastedassign   # бесполезные присваивания
    - zerologlint    # проверка zerolog
    
    # === ДОПОЛНИТЕЛЬНЫЕ ===
    - misspell       # проверка орфографии
    - whitespace     # пробелы
    - wsl_v5         # пустые строки
    - tagalign       # выравнивание тегов
    - tagliatelle    # проверка тегов
    - asciicheck     # проверка ASCII символов
    - bidichk        # проверка Unicode
    - canonicalheader # каноничные заголовки
    - decorder       # порядок объявлений
    - dogsled        # слишком много пустых идентификаторов
    - dupl           # дублирование кода
    - dupword        # дублирование слов
    - embeddedstructfieldcheck # встроенные поля
    # - err113         # обработка ошибок (слишком строгий)
    - exhaustive     # исчерпывающие switch
    # - exhaustruct    # инициализация структур (слишком строгий)
    - ginkgolinter   # проверки ginkgo
    - gocheckcompilerdirectives # директивы компилятора
    - godox          # TODO/FIXME комментарии
    - importas       # алиасы импортов

linters-settings:
  # Настройки govet
  govet:
    enable:
      - assign
      - atomic
      - bools
      - buildtag
      - errorsas
      - httpresponse
      - loopclosure
      - lostcancel
      - nilfunc
      - printf
      - shadow
      - shift
      - sortslice
      - tests
      - timeformat
      - unusedwrite
    disable:
      - fieldalignment  # может быть слишком строгим
  
  # Настройки gocritic
  gocritic:
    enabled-tags:
      - diagnostic
      - style
      - performance
      - experimental
    disabled-checks:
      - dupImport
      - ifElseChain
      - octalLiteral
      - whyNoLint
      - wrapperFunc
  
  # Настройки gosec
  gosec:
    severity: medium
    confidence: medium
    excludes:
      - G204  # subprocess launched with variable
      - G304  # file path provided as taint input
  
  # Настройки gocyclo
  gocyclo:
    min-complexity: 15
  
  # Настройки funlen
  funlen:
    lines: 100
    statements: 50
  
  # Настройки gocognit
  gocognit:
    min-complexity: 20
  
  # Настройки nestif
  nestif:
    min-complexity: 5
  
  # Настройки mnd
  mnd:
    # Исключения для магических чисел
    ignored-numbers: "0,1,2,3,4,5"
    ignored-functions: "strings.Split,strings.Join"
  
  # Настройки depguard
  depguard:
    rules:
      main:
        deny:
          - pkg: "github.com/sirupsen/logrus"
            desc: "use log/slog instead"
        allow:
          - pkg: "language-exchange-bot/internal/models"
          - pkg: "language-exchange-bot/internal/cache"
          - pkg: "language-exchange-bot/internal/config"
          - pkg: "language-exchange-bot/internal/database"
          - pkg: "language-exchange-bot/internal/errors"
          - pkg: "language-exchange-bot/internal/localization"
          - pkg: "language-exchange-bot/internal/logging"
          - pkg: "language-exchange-bot/internal/validation"
          - pkg: "github.com/redis/go-redis/v9"
          - pkg: "github.com/joho/godotenv"
          - pkg: "github.com/lib/pq"
  
  # Настройки gomodguard
  gomodguard:
    allowed:
      modules: []
      domains: []
    blocked:
      modules: []
      versions: []
      local_replace_directories: []

issues:
  # Исключения директорий и файлов
  exclude-dirs:
    - vendor
    - node_modules
    - .git
  
  exclude-files:
    - ".*_test.go$"
    - ".*_mock.go$"
  
  # Исключения правил
  exclude-rules:
    # Исключить устаревшие линтеры
    - linters: [golint]
      text: "should have comment"
    
    # Исключить некоторые проверки для тестов
    - linters: [gocyclo, funlen, gocognit]
      path: ".*_test.go$"
    
    # Исключить проверки для моков
    - linters: [gocyclo, funlen, gocognit, nestif]
      path: ".*_mock.go$"
    
    # Исключить проверки для vendor
    - linters: [all]
      path: "vendor/.*"
  
  # Максимальные лимиты
  max-issues-per-linter: 0
  max-same-issues: 0
  max-from-linter: 0
  
  # Новые проблемы
  new: false
  
  # Исправления
  fix: true

# Настройки вывода
output:
  format: colored-line-number
  print-issued-line: true
  print-linter-name: true
  uniq-by-line: true
  sort-results: true
