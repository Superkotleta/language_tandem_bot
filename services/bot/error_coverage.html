
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>errors: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">language-exchange-bot/internal/errors/alerting.go (82.4%)</option>
				
				<option value="file1">language-exchange-bot/internal/errors/handler.go (81.1%)</option>
				
				<option value="file2">language-exchange-bot/internal/errors/tracing.go (50.0%)</option>
				
				<option value="file3">language-exchange-bot/internal/errors/types.go (58.6%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package errors

import (
        "fmt"
        "log"
)

// AdminNotifierImpl —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
type AdminNotifierImpl struct {
        adminChatIDs []int64
        botAPI       interface{} // Telegram Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
}

// NewAdminNotifier —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —É–≤–µ–¥–æ–º–∏—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
func NewAdminNotifier(adminChatIDs []int64, botAPI interface{}) *AdminNotifierImpl <span class="cov8" title="1">{
        return &amp;AdminNotifierImpl{
                adminChatIDs: adminChatIDs,
                botAPI:       botAPI,
        }
}</span>

// NotifyCriticalError —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ
func (n *AdminNotifierImpl) NotifyCriticalError(err *CustomError) <span class="cov8" title="1">{
        message := fmt.Sprintf(`
üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê**

**–¢–∏–ø:** %s
**–í—Ä–µ–º—è:** %s
**RequestID:** %s
**–°–æ–æ–±—â–µ–Ω–∏–µ:** %s

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
- User ID: %v
- Chat ID: %v
- –û–ø–µ—Ä–∞—Ü–∏—è: %v

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
%s
`,
                err.Type.String(),
                err.Timestamp.Format("2006-01-02 15:04:05"),
                err.RequestID,
                err.Message,
                err.Context["user_id"],
                err.Context["chat_id"],
                err.Context["operation"],
                n.formatContext(err.Context),
        )

        n.sendToAdmins(message)
}</span>

// NotifyTelegramAPIError —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ–± –æ—à–∏–±–∫–µ Telegram API
func (n *AdminNotifierImpl) NotifyTelegramAPIError(err *CustomError, chatID int64) <span class="cov8" title="1">{
        message := fmt.Sprintf(`
‚ö†Ô∏è **–û–®–ò–ë–ö–ê TELEGRAM API**

**–í—Ä–µ–º—è:** %s
**RequestID:** %s
**Chat ID:** %d
**–°–æ–æ–±—â–µ–Ω–∏–µ:** %s

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
- User ID: %v
- –û–ø–µ—Ä–∞—Ü–∏—è: %v
`,
                err.Timestamp.Format("2006-01-02 15:04:05"),
                err.RequestID,
                chatID,
                err.Message,
                err.Context["user_id"],
                err.Context["operation"],
        )

        n.sendToAdmins(message)
}</span>

// sendToAdmins –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
func (n *AdminNotifierImpl) sendToAdmins(message string) <span class="cov8" title="1">{
        for _, chatID := range n.adminChatIDs </span><span class="cov8" title="1">{
                n.sendMessage(chatID, message)
        }</span>
}

// sendMessage –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram API)
func (n *AdminNotifierImpl) sendMessage(chatID int64, message string) <span class="cov8" title="1">{
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API
        // –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
        log.Printf("Admin notification to chat %d: %s", chatID, message)

        // TODO: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram Bot API
        // –ü—Ä–∏–º–µ—Ä:
        // if botAPI, ok := n.botAPI.(*tgbotapi.BotAPI); ok {
        //     msg := tgbotapi.NewMessage(chatID, message)
        //     msg.ParseMode = tgbotapi.ModeMarkdown
        //     botAPI.Send(msg)
        // }
}</span>

// formatContext —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
func (n *AdminNotifierImpl) formatContext(context map[string]interface{}) string <span class="cov8" title="1">{
        result := ""
        for key, value := range context </span><span class="cov8" title="1">{
                if key != "user_id" &amp;&amp; key != "chat_id" &amp;&amp; key != "operation" </span><span class="cov0" title="0">{
                        result += fmt.Sprintf("- %s: %v\n", key, value)
                }</span>
        }
        <span class="cov8" title="1">if result == "" </span><span class="cov8" title="1">{
                return "–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
        }</span>
        <span class="cov0" title="0">return result</span>
}

// SetAdminChatIDs –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ Chat ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
func (n *AdminNotifierImpl) SetAdminChatIDs(chatIDs []int64) <span class="cov0" title="0">{
        n.adminChatIDs = chatIDs
}</span>

// GetAdminChatIDs –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ Chat ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
func (n *AdminNotifierImpl) GetAdminChatIDs() []int64 <span class="cov8" title="1">{
        return n.adminChatIDs
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package errors

import (
        "log"
)

// ErrorHandler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ
type ErrorHandler struct {
        notifier AdminNotifier
}

// AdminNotifier –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
type AdminNotifier interface {
        NotifyCriticalError(err *CustomError)
        NotifyTelegramAPIError(err *CustomError, chatID int64)
}

// NewErrorHandler —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
func NewErrorHandler(notifier AdminNotifier) *ErrorHandler <span class="cov8" title="1">{
        return &amp;ErrorHandler{
                notifier: notifier,
        }
}</span>

// Handle –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func (h *ErrorHandler) Handle(err error, ctx *RequestContext) error <span class="cov8" title="1">{
        if err == nil </span><span class="cov0" title="0">{
                return nil
        }</span>

        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        <span class="cov8" title="1">h.logError(err, ctx)

        // –ï—Å–ª–∏ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, —É–≤–µ–¥–æ–º–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
        if h.isCriticalError(err) </span><span class="cov8" title="1">{
                if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                        h.notifier.NotifyCriticalError(customErr)
                }</span>
        }

        // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ Telegram API, —É–≤–µ–¥–æ–º–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
        <span class="cov8" title="1">if IsTelegramAPIError(err) </span><span class="cov8" title="1">{
                if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                        h.notifier.NotifyTelegramAPIError(customErr, ctx.ChatID)
                }</span>
        }

        <span class="cov8" title="1">return err</span>
}

// HandleTelegramError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ Telegram API
func (h *ErrorHandler) HandleTelegramError(err error, chatID int64, userID int64, operation string) error <span class="cov8" title="1">{
        if err == nil </span><span class="cov0" title="0">{
                return nil
        }</span>

        <span class="cov8" title="1">ctx := NewRequestContext(userID, chatID, operation)

        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É
        customErr := NewTelegramError(
                err.Error(),
                "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                ctx,
        ).WithCause(err)

        return h.Handle(customErr, ctx)</span>
}

// HandleDatabaseError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func (h *ErrorHandler) HandleDatabaseError(err error, userID int64, chatID int64, operation string) error <span class="cov8" title="1">{
        if err == nil </span><span class="cov0" title="0">{
                return nil
        }</span>

        <span class="cov8" title="1">ctx := NewRequestContext(userID, chatID, operation)

        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É
        customErr := NewDatabaseError(
                err.Error(),
                "–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                ctx,
        ).WithCause(err)

        return h.Handle(customErr, ctx)</span>
}

// HandleValidationError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
func (h *ErrorHandler) HandleValidationError(err error, userID int64, chatID int64, operation string) error <span class="cov8" title="1">{
        if err == nil </span><span class="cov0" title="0">{
                return nil
        }</span>

        <span class="cov8" title="1">ctx := NewRequestContext(userID, chatID, operation)

        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É
        customErr := NewValidationError(
                err.Error(),
                "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.",
                ctx,
        ).WithCause(err)

        return h.Handle(customErr, ctx)</span>
}

// HandleCacheError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∫—ç—à–∞
func (h *ErrorHandler) HandleCacheError(err error, userID int64, chatID int64, operation string) error <span class="cov8" title="1">{
        if err == nil </span><span class="cov0" title="0">{
                return nil
        }</span>

        <span class="cov8" title="1">ctx := NewRequestContext(userID, chatID, operation)

        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É
        customErr := NewCacheError(
                err.Error(),
                "–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–µ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                ctx,
        ).WithCause(err)

        return h.Handle(customErr, ctx)</span>
}

// logError –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func (h *ErrorHandler) logError(err error, ctx *RequestContext) <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                log.Printf("[%s] %s: %s (User: %d, Chat: %d, Operation: %s)",
                        customErr.RequestID,
                        customErr.Type.String(),
                        customErr.Message,
                        ctx.UserID,
                        ctx.ChatID,
                        ctx.Operation,
                )
        }</span> else<span class="cov0" title="0"> {
                log.Printf("[%s] Error: %v (User: %d, Chat: %d, Operation: %s)",
                        ctx.RequestID,
                        err,
                        ctx.UserID,
                        ctx.ChatID,
                        ctx.Operation,
                )
        }</span>
}

// isCriticalError –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π
func (h *ErrorHandler) isCriticalError(err error) bool <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏: Database, Network, Internal
                return customErr.Type == ErrorTypeDatabase ||
                        customErr.Type == ErrorTypeNetwork ||
                        customErr.Type == ErrorTypeInternal
        }</span>
        <span class="cov0" title="0">return false</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package errors

import (
        "fmt"
        "time"
)

// RequestContext —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
type RequestContext struct {
        RequestID string
        UserID    int64
        ChatID    int64
        Operation string
        Timestamp time.Time
}

// NewRequestContext —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
func NewRequestContext(userID, chatID int64, operation string) *RequestContext <span class="cov8" title="1">{
        return &amp;RequestContext{
                RequestID: generateRequestID(),
                UserID:    userID,
                ChatID:    chatID,
                Operation: operation,
                Timestamp: time.Now(),
        }
}</span>

// generateRequestID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π RequestID
func generateRequestID() string <span class="cov8" title="1">{
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º timestamp + —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
        timestamp := time.Now().UnixNano()
        return fmt.Sprintf("req_%d_%d", timestamp, time.Now().Unix()%10000)
}</span>

// WithContext —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func WithContext(err error, ctx *RequestContext) *CustomError <span class="cov0" title="0">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov0" title="0">{
                customErr.RequestID = ctx.RequestID
                customErr.Context["user_id"] = ctx.UserID
                customErr.Context["chat_id"] = ctx.ChatID
                customErr.Context["operation"] = ctx.Operation
                return customErr
        }</span>

        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ CustomError, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –µ—ë
        <span class="cov0" title="0">return &amp;CustomError{
                Type:      ErrorTypeInternal,
                Message:   err.Error(),
                RequestID: ctx.RequestID,
                Context: map[string]interface{}{
                        "user_id":   ctx.UserID,
                        "chat_id":   ctx.ChatID,
                        "operation": ctx.Operation,
                },
                Timestamp: time.Now(),
                Cause:     err,
        }</span>
}

// NewTelegramError —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É Telegram API —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func NewTelegramError(message, userMessage string, ctx *RequestContext) *CustomError <span class="cov8" title="1">{
        return &amp;CustomError{
                Type:        ErrorTypeTelegramAPI,
                Message:     message,
                UserMessage: userMessage,
                RequestID:   ctx.RequestID,
                Context: map[string]interface{}{
                        "user_id":   ctx.UserID,
                        "chat_id":   ctx.ChatID,
                        "operation": ctx.Operation,
                },
                Timestamp: time.Now(),
        }
}</span>

// NewDatabaseError —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func NewDatabaseError(message, userMessage string, ctx *RequestContext) *CustomError <span class="cov8" title="1">{
        return &amp;CustomError{
                Type:        ErrorTypeDatabase,
                Message:     message,
                UserMessage: userMessage,
                RequestID:   ctx.RequestID,
                Context: map[string]interface{}{
                        "user_id":   ctx.UserID,
                        "chat_id":   ctx.ChatID,
                        "operation": ctx.Operation,
                },
                Timestamp: time.Now(),
        }
}</span>

// NewValidationError —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func NewValidationError(message, userMessage string, ctx *RequestContext) *CustomError <span class="cov8" title="1">{
        return &amp;CustomError{
                Type:        ErrorTypeValidation,
                Message:     message,
                UserMessage: userMessage,
                RequestID:   ctx.RequestID,
                Context: map[string]interface{}{
                        "user_id":   ctx.UserID,
                        "chat_id":   ctx.ChatID,
                        "operation": ctx.Operation,
                },
                Timestamp: time.Now(),
        }
}</span>

// NewCacheError —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É –∫—ç—à–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
func NewCacheError(message, userMessage string, ctx *RequestContext) *CustomError <span class="cov8" title="1">{
        return &amp;CustomError{
                Type:        ErrorTypeCache,
                Message:     message,
                UserMessage: userMessage,
                RequestID:   ctx.RequestID,
                Context: map[string]interface{}{
                        "user_id":   ctx.UserID,
                        "chat_id":   ctx.ChatID,
                        "operation": ctx.Operation,
                },
                Timestamp: time.Now(),
        }
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package errors

import (
        "fmt"
        "time"
)

// ErrorType –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ—à–∏–±–∫–∏
type ErrorType int

const (
        ErrorTypeTelegramAPI ErrorType = iota
        ErrorTypeDatabase
        ErrorTypeValidation
        ErrorTypeCache
        ErrorTypeNetwork
        ErrorTypeInternal
)

// String –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏
func (et ErrorType) String() string <span class="cov8" title="1">{
        switch et </span>{
        case ErrorTypeTelegramAPI:<span class="cov8" title="1">
                return "TelegramAPI"</span>
        case ErrorTypeDatabase:<span class="cov8" title="1">
                return "Database"</span>
        case ErrorTypeValidation:<span class="cov8" title="1">
                return "Validation"</span>
        case ErrorTypeCache:<span class="cov8" title="1">
                return "Cache"</span>
        case ErrorTypeNetwork:<span class="cov0" title="0">
                return "Network"</span>
        case ErrorTypeInternal:<span class="cov0" title="0">
                return "Internal"</span>
        default:<span class="cov0" title="0">
                return "Unknown"</span>
        }
}

// CustomError –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
type CustomError struct {
        Type        ErrorType
        Message     string
        UserMessage string
        Context     map[string]interface{}
        RequestID   string
        Timestamp   time.Time
        Cause       error
}

// Error —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å error
func (e *CustomError) Error() string <span class="cov8" title="1">{
        if e.Cause != nil </span><span class="cov8" title="1">{
                return fmt.Sprintf("[%s] %s (caused by: %v)", e.Type.String(), e.Message, e.Cause.Error())
        }</span>
        <span class="cov0" title="0">return fmt.Sprintf("[%s] %s", e.Type.String(), e.Message)</span>
}

// Unwrap –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –¥–ª—è error wrapping
func (e *CustomError) Unwrap() error <span class="cov0" title="0">{
        return e.Cause
}</span>

// NewCustomError —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É
func NewCustomError(errorType ErrorType, message, userMessage string, requestID string) *CustomError <span class="cov0" title="0">{
        return &amp;CustomError{
                Type:        errorType,
                Message:     message,
                UserMessage: userMessage,
                Context:     make(map[string]interface{}),
                RequestID:   requestID,
                Timestamp:   time.Now(),
        }
}</span>

// WithContext –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ –æ—à–∏–±–∫–µ
func (e *CustomError) WithContext(key string, value interface{}) *CustomError <span class="cov0" title="0">{
        e.Context[key] = value
        return e
}</span>

// WithCause –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏
func (e *CustomError) WithCause(cause error) *CustomError <span class="cov8" title="1">{
        e.Cause = cause
        return e
}</span>

// IsTelegramAPIError –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –æ—à–∏–±–∫–æ–π Telegram API
func IsTelegramAPIError(err error) bool <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                return customErr.Type == ErrorTypeTelegramAPI
        }</span>
        <span class="cov0" title="0">return false</span>
}

// IsDatabaseError –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –æ—à–∏–±–∫–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func IsDatabaseError(err error) bool <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                return customErr.Type == ErrorTypeDatabase
        }</span>
        <span class="cov0" title="0">return false</span>
}

// IsValidationError –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –æ—à–∏–±–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
func IsValidationError(err error) bool <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                return customErr.Type == ErrorTypeValidation
        }</span>
        <span class="cov0" title="0">return false</span>
}

// IsCacheError –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –æ—à–∏–±–∫–æ–π –∫—ç—à–∞
func IsCacheError(err error) bool <span class="cov8" title="1">{
        if customErr, ok := err.(*CustomError); ok </span><span class="cov8" title="1">{
                return customErr.Type == ErrorTypeCache
        }</span>
        <span class="cov0" title="0">return false</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
