# Руководство по использованию golangci-lint

## Обзор

Расширенная конфигурация `.golangci.yml` включает множество линтеров для улучшения качества кода, безопасности и производительности.

## Основные категории линтеров

### 1. Базовые линтеры

- `unused` - неиспользуемые переменные и функции
- `deadcode` - мертвый код
- `structcheck` - неиспользуемые поля структур
- `varcheck` - неиспользуемые переменные

### 2. Стиль кода и форматирование

- `gofmt` - проверка форматирования кода
- `goimports` - проверка импортов
- `gosimple` - упрощение кода
- `govet` - статический анализ
- `ineffassign` - неэффективные присваивания
- `misspell` - проверка орфографии
- `unconvert` - ненужные преобразования типов
- `whitespace` - лишние пробелы

### 3. Безопасность

- `gosec` - проверка безопасности кода
- `errcheck` - проверка обработки ошибок
- `errorlint` - правильное использование ошибок

### 4. Производительность

- `gocyclo` - сложность циклов (максимум 15)
- `gocognit` - когнитивная сложность (максимум 20)
- `goconst` - использование констант
- `gomnd` - магические числа
- `gocritic` - критические замечания

### 5. Документация

- `godot` - точки в комментариях
- `godox` - TODO комментарии

### 6. Специфичные для HTTP/API

- `bodyclose` - закрытие HTTP тел
- `noctx` - использование контекста в HTTP запросах

## Настройки

### Сложность кода

- **gocyclo**: максимум 15 (сложность циклов)
- **gocognit**: максимум 20 (когнитивная сложность)
- **lll**: максимум 120 символов в строке

### Магические числа (gomnd)

Игнорируются числа: 0, 1, 2, 3, 4, 5, 10, 100, 1000
Игнорируются функции: strings.Split, bytes.Split и их варианты

### Безопасность (gosec)

- Уровень серьезности: medium
- Уровень уверенности: medium
- Исключения: G204, G304

## Исключения

### Тестовые файлы (*_test.go)

Исключены проверки:

- gomnd (магические числа)
- gocyclo (сложность циклов)
- gocognit (когнитивная сложность)
- lll (длина строк)

### Мок-файлы (*_mock.go)

Исключены проверки:

- gomnd
- gocyclo
- gocognit

### Сгенерированные файлы (*.pb.go)

Исключены проверки:

- gomnd
- gocyclo
- gocognit
- lll
- revive

### main.go

Исключены проверки:

- gocyclo
- gocognit

## Запуск линтера

### Локально

```bash
# Установка golangci-lint
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# Запуск в корне проекта
golangci-lint run

# Запуск с подробным выводом
golangci-lint run -v

# Запуск только определенных линтеров
golangci-lint run --enable=gofmt,goimports,govet

# Автоисправление
golangci-lint run --fix
```

### В CI/CD

```yaml
# GitHub Actions пример
- name: Run golangci-lint
  uses: golangci/golangci-lint-action@v3
  with:
    version: latest
    args: --timeout=5m
```

## Рекомендации

1. **Постепенное внедрение**: Начните с базовых линтеров, затем добавляйте остальные
2. **Автоисправление**: Используйте `--fix` для автоматического исправления
3. **Исключения**: Настраивайте исключения для специфичных случаев
4. **CI/CD**: Интегрируйте в pipeline для автоматической проверки
5. **Обучение команды**: Обучите команду правилам и настройкам

## Полезные команды

```bash
# Проверка конфигурации
golangci-lint config verify

# Список всех линтеров
golangci-lint linters

# Список включенных линтеров
golangci-lint linters --enable-all

# Проверка конкретного файла
golangci-lint run path/to/file.go

# Проверка с выводом в JSON
golangci-lint run --out-format=json
```

## Troubleshooting

### Медленная работа

- Увеличьте timeout в конфигурации
- Исключите ненужные директории
- Используйте кэширование

### Слишком много ошибок

- Настройте исключения для тестов
- Увеличьте пороги сложности
- Отключите проблемные линтеры

### Конфликты линтеров

- Проверьте настройки в linters-settings
- Отключите конфликтующие проверки
- Используйте приоритеты линтеров
